apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet

spec:
  generators:
  - git:
    repoURL: https://github.com/rlaisqls/xquare-gitops-repo-staging.git
    revision: HEAD
      files:
        - path: resource/**.json
          values:
            json_value: "{{value}}"

template: 
  metadata:
    name: {{ path[0] }}
    namespace: argocd

  spec:
    destination:
      server: {{ .Values.spec.destination.server }} 
      namespace: be-stag

    project: {{ .Values.spec.project }}

    source:
      path: {{ path }}
      repoURL: {{ .Values.spec.source.repoURL }}
      targetRevision: {{ .Values.spec.source.targetRevision }}

    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      syncOptions:
        - CreateNamespace=true

